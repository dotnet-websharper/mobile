<!--
***********************************************************************************************
IntelliFactory.WebSharper.PhoneGap.Sitelets.targets

WARNING:  DO NOT MODIFY this file unless you are knowledgeable about MSBuild and have
          created a backup copy.  Incorrect changes to this file will make it
          impossible to load or build your projects from the command-line or the IDE.

This file defines MSBuild targets used by IntelliFactory WebSharper(TM) Platform.

This file is confidential and proprietary.

Copyright (c) IntelliFactory, 2004-2011.

All rights reserved.  Reproduction or use in whole or in part is
prohibited without the written consent of the copyright holder.

***********************************************************************************************
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup>
      <Reference Include="IntelliFactory.WebSharper.Mobile.Default" />
      <Reference Include="IntelliFactory.WebSharper.Mobile.WP7" />
	  <Reference Include="IntelliFactory.WebSharper.Mobile.Android" />
  </ItemGroup>
  <Import Project="$(WEBSHARPER_HOME)/IntelliFactory.WebSharper.FSharp.targets" />
  <UsingTask AssemblyFile="IntelliFactory.WebSharper.Sitelets.Build.dll"
             TaskName="IntelliFactory.WebSharper.Sitelets.Build.BuildPageTemplates" />
  <PropertyGroup>
    <BuildDependsOn>WebSharperSiteletsBuild;$(BuildDependsOn);WebSharperSiteletsOfflineGenerate</BuildDependsOn>
    <CleanDependsOn>$(CleanDependsOn);WebSharperSiteletsClean;WebSharperSiteletsOfflineClean</CleanDependsOn>
  </PropertyGroup>
  <Target Name="WebSharperSiteletsBuild">      
    <ItemGroup>
      <WebSharperTarget Include="$(TargetPath)" />
    </ItemGroup>
    <Touch AlwaysCreate="true" Files="@(WebSharperTarget->'%(FullPath).site')" />
    <BuildPageTemplates Source="@(Compile)" Namespace="$(RootNamespace)">
      <Output TaskParameter="Output" ItemName="Compile_" />
    </BuildPageTemplates>
    <ItemGroup>
      <Compile Remove="@(Compile)" />
      <Compile Include="@(Compile_)" />
    </ItemGroup>
  </Target>
  <Target Name="WebSharperSiteletsOfflineGenerate" Condition="'$(WebSharperSiteletsOfflineDirectory)' != ''">
    <PropertyGroup>
      <Args>-source "."</Args>
      <Args>$(Args) -source "$(WEBSHARPER_HOME)\."</Args>
      <Args>$(Args) -out "$(WebSharperSiteletsOfflineDirectory)\."</Args>
      <Args>$(Args) -site "$(TargetPath)"</Args>      
    </PropertyGroup>
    <Exec Command="&quot;$(WEBSHARPER_HOME)\wsol.exe&quot; $(Args)" WorkingDirectory="$(OutDir)" />
    <Exec Command="&quot;$(WEBSHARPER_HOME)\ws_mobile.exe&quot; &quot;$(ProjectDir).&quot; &quot;$(WebSharperSiteletsOfflineDirectory).&quot; &quot;$(TargetFileName)&quot;" WorkingDirectory="$(WEBSHARPER_HOME)" />
  </Target>
  <Target Name="WebSharperSiteletsClean">
    <ItemGroup>
      <WebSharperTarget Include="$(TargetPath)" />
      <WebSharperToClean Include="@(WebSharperTarget->'%(FullPath).site')" />
    </ItemGroup>
    <Delete Files="@(WebSharperToClean)" />
  </Target>
  <Target Name="WebSharperSiteletsOfflineClean" Condition="'$(WebSharperSiteletsOfflineDirectory)' != ''">
    <RemoveDir Directories="$(WebSharperSiteletsOfflineDirectory)" />
  </Target>
</Project>
